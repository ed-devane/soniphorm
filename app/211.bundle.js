/*! For license information please see 211.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkesp32_patcher=self.webpackChunkesp32_patcher||[]).push([[211],{211:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function s(r,n,i,o){var s=n&&n.prototype instanceof l?n:l,u=Object.create(s.prototype);return a(u,"_invoke",function(r,n,i){var a,o,s,l=0,u=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,o=0,s=e,h.n=r,c}};function p(r,n){for(o=r,s=n,t=0;!f&&l&&!i&&t<u.length;t++){var i,a=u[t],p=h.p,d=a[2];r>3?(i=d===n)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=r<2&&p<a[1])?(o=0,h.v=n,h.n=a[1]):p<d&&(i=r<3||a[0]>n||n>d)&&(a[4]=r,a[5]=n,h.n=d,o=0))}if(i||r>1)return c;throw f=!0,n}return function(i,u,d){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&p(u,d),o=u,s=d;(t=o<2?e:s)||!f;){a||(o?o<3?(o>1&&(h.n=-1),p(o,s)):h.n=s:h.v=s);try{if(l=2,a){if(o||(i="next"),t=a[i]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,o<2&&(o=0)}else 1===o&&(t=a.return)&&t.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=e}else if((t=(f=h.n<0)?s:r.call(n,h))!==c)break}catch(t){a=e,o=1,s=t}finally{l=1}}return{value:t,done:f}}}(r,i,o),!0),u}var c={};function l(){}function u(){}function f(){}t=Object.getPrototypeOf;var h=[][n]?t(t([][n]())):(a(t={},n,function(){return this}),t),p=f.prototype=l.prototype=Object.create(h);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,a(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=f,a(p,"constructor",f),a(f,"constructor",u),u.displayName="GeneratorFunction",a(f,o,"GeneratorFunction"),a(p),a(p,o,"Generator"),a(p,n,function(){return this}),a(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:s,m:d}})()}function a(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}a=function(e,t,r,n){function o(t,r){a(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},a(e,t,r,n)}function o(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,c,"next",e)}function c(e){o(a,n,i,s,c,"throw",e)}s(void 0)})}}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function l(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var u,f;r.r(t),r.d(t,{ESP32Uploader:()=>h,isESP32UploadSupported:()=>p});var h=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loader=null,this.device=null,this.transport=null,this.chip=null,this.terminal={clean:function(){},writeLine:function(e){return console.log("ESP:",e)},write:function(e){return console.log("ESP:",e)}}},t=[{key:"loadEsptool",value:(p=s(i().m(function e(){var t,n,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(u){e.n=8;break}return e.p=1,this.terminal.writeLine("Loading esptool-js library..."),e.p=2,e.n=3,r.e(493).then(r.bind(r,493));case 3:t=e.v,u=t.ESPLoader,f=t.Transport,t.FlashOptions,t.LoaderOptions,e.n=6;break;case 4:return e.p=4,e.v,e.n=5,r.e(493).then(r.bind(r,493));case 5:n=e.v,u=n.ESPLoader,f=n.Transport,n.FlashOptions,n.LoaderOptions;case 6:this.terminal.writeLine("‚úÖ esptool-js loaded successfully"),e.n=8;break;case 7:throw e.p=7,a=e.v,this.terminal.writeLine("‚ùå Failed to load esptool-js: ".concat(a.message)),new Error("Failed to load esptool-js: ".concat(a.message));case 8:return e.a(2)}},e,this,[[2,4],[1,7]])})),function(){return p.apply(this,arguments)})},{key:"setTerminal",value:function(e){this.terminal=e}},{key:"connect",value:(h=s(i().m(function e(){var t,r,n,a,o,s,c,l=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:null,e.p=1,e.n=2,this.loadEsptool();case 2:if(!t){e.n=3;break}this.terminal.writeLine("Using existing ESP32 connection..."),this.device=t,this.terminal.writeLine("‚úÖ Using already-selected ESP32 port"),e.n=7;break;case 3:return this.terminal.writeLine("Requesting ESP32 connection..."),e.p=4,e.n=5,navigator.serial.requestPort({filters:[{usbVendorId:12346},{usbVendorId:4292},{usbVendorId:6790},{usbVendorId:1027},{usbVendorId:6421}]});case 5:this.device=e.v,this.terminal.writeLine("‚úÖ ESP32 port selected"),e.n=7;break;case 6:throw e.p=6,n=e.v,this.terminal.writeLine("‚ùå Port selection failed: ".concat(n.message)),n;case 7:e.p=7,this.terminal.writeLine("Creating transport..."),this.transport=new f(this.device,!0),this.terminal.writeLine("‚úÖ Transport created"),e.n=9;break;case 8:throw e.p=8,a=e.v,this.terminal.writeLine("‚ùå Transport creation failed: ".concat(a.message)),a;case 9:e.p=9,this.terminal.writeLine("Creating ESPLoader..."),r={transport:this.transport,baudrate:115200,terminal:this.terminal,debugLogging:!0},this.loader=new u(r),this.terminal.writeLine("‚úÖ ESPLoader created"),e.n=11;break;case 10:throw e.p=10,o=e.v,this.terminal.writeLine("‚ùå ESPLoader creation failed: ".concat(o.message)),o;case 11:return this.terminal.writeLine("Identifying ESP32 chip..."),e.p=12,e.n=13,this.loader.main();case 13:this.chip=e.v,this.terminal.writeLine("‚úÖ Connected to ".concat(this.chip.CHIP_NAME)),e.n=15;break;case 14:throw e.p=14,s=e.v,this.terminal.writeLine("‚ùå Chip identification failed: ".concat(s.message)),s;case 15:return e.a(2,this.device);case 16:throw e.p=16,c=e.v,this.terminal.writeLine("‚ùå Overall connection failed: ".concat(c.message)),new Error("ESP32 connection failed: ".concat(c.message));case 17:return e.a(2)}},e,this,[[12,14],[9,10],[7,8],[4,6],[1,16]])})),function(){return h.apply(this,arguments)})},{key:"disconnect",value:(l=s(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.loader){e.n=6;break}return e.p=1,e.n=2,this.loader.hardReset();case 2:if(!this.transport){e.n=3;break}return e.n=3,this.transport.disconnect();case 3:e.n=5;break;case 4:e.p=4,t=e.v,console.warn("Disconnect error:",t);case 5:this.loader=null,this.transport=null,this.device=null;case 6:return e.a(2)}},e,this,[[1,4]])})),function(){return l.apply(this,arguments)})},{key:"uploadFirmware",value:(o=s(i().m(function e(t,r){var n,a,o,c,l=this;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.loader){e.n=1;break}throw new Error("ESP32 not connected. Call connect() first.");case 1:for(e.p=1,r(0),this.terminal.writeLine("üì§ Starting firmware upload..."),this.terminal.writeLine("Firmware size: ".concat((t.length/1024).toFixed(1)," KB")),n="",a=0;a<t.length;a++)n+=String.fromCharCode(t[a]);return this.terminal.writeLine("üì° Writing firmware data..."),o={fileArray:[{data:n,address:65536}],flashSize:"keep",eraseAll:!1,compress:!0,reportProgress:function(e,t,n){r(10+t/n*80);var i=Math.round(t/n*100);i%10==0&&l.terminal.writeLine("Writing... ".concat(i,"% (").concat((t/1024).toFixed(0),"KB / ").concat((n/1024).toFixed(0),"KB)"))},calculateMD5Hash:function(){var e=s(i().m(function e(t){var r,n,a,o,s,c;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:for(e.p=0,r=new TextEncoder,n=r.encode(t),a=0,o=0;o<n.length;o++)a=(a<<5)-a+n[o]&4294967295;return s=Math.abs(a).toString(16).padStart(8,"0"),e.a(2,s+s+s+s);case 1:return e.p=1,c=e.v,l.terminal.writeLine("‚ö†Ô∏è  MD5 calculation failed, using fallback: ".concat(c.message)),e.a(2,"00000000000000000000000000000000")}},e,null,[[0,1]])}));return function(t){return e.apply(this,arguments)}}()},e.n=2,this.loader.writeFlash(o);case 2:return r(95),this.terminal.writeLine("üîÑ Finalizing and restarting ESP32..."),e.n=3,this.loader.after();case 3:r(100),this.terminal.writeLine("‚úÖ Upload complete!"),this.terminal.writeLine("üéµ ESP32 is running new firmware"),e.n=5;break;case 4:throw e.p=4,c=e.v,this.terminal.writeLine("‚ùå Upload error: ".concat(c.message)),new Error("Upload failed: ".concat(c.message));case 5:return e.a(2)}},e,this,[[1,4]])})),function(e,t){return o.apply(this,arguments)})},{key:"getChipInfo",value:(a=s(i().m(function e(){var t,r,n,a,o;return i().w(function(e){for(;;)switch(e.n){case 0:if(this.loader){e.n=1;break}throw new Error("ESP32 not connected");case 1:if(t=this.loader.chip.CHIP_NAME,!this.loader.chip.get_mac_addr){e.n=3;break}return e.n=2,this.loader.chip.get_mac_addr();case 2:r=e.v,e.n=4;break;case 3:r="Unknown";case 4:return n=r,a=this.loader.flash_id?this.loader.flash_id().toString(16):"Unknown",o=this.loader.flash_size||"Unknown",e.a(2,{chipName:t,macAddress:n,flashId:a,flashSize:o})}},e,this)})),function(){return a.apply(this,arguments)})}],n=[{key:"prepareFirmware",value:function(e){if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e instanceof Uint8Array)return e;throw new Error("Invalid firmware format. Expected ArrayBuffer or Uint8Array")}}],t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,a,o,l,h,p}(),p=function(){return"serial"in navigator&&(navigator.userAgent.includes("Chrome")||navigator.userAgent.includes("Edg"))}}}]);